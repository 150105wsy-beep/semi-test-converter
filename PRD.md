# PRD: 半导体测试数据转换工具 (CSV to TXT)

## 1. 项目背景

本工具用于将半导体测试设备生成的原始 CSV 数据，转换为符合特定分析软件格式要求的 TXT 文档。转换过程涉及动态参数注入、标识符序列替换以及严格的文本对齐。

## 2. 核心功能需求

### 2.1 用户输入模块 (UI)

* **文件上传**：支持上传一个或多个 `.csv` 文件。

* **参数配置**：

* `Vds` (变量 `a`)：浮点数/字符串输入（默认值：0.1）。

* `W` (变量 `w`)：浮点数/字符串输入（默认值：1）。

* `L` (变量 `b`)：浮点数/字符串输入（默认值：10）。

* **执行按钮**：点击开始转换并提供转换后的文件下载。

### 2.2 数据处理逻辑

转换程序需严格遵守以下顺序逻辑：

#### A. 头部信息注入 (Header)

在 TXT 文件最顶端插入两行固定格式代码（**两行之间需有一个空行**）：

1. `condition{date=1/5/26,instrument=pseudo.meter,mode=forward,type=nmos}`

2. （空行）

3. `Page (name=Ids_Vgs_Vbs,x=Vgs,p=Vbs,y=Ids){Vds={a},W={w},L={b},T=25}`

* *注：将 `{a}`、`{w}` 和 `{b}` 替换为用户在 UI 中输入的值。日期格式为 M/D/YY，自动获取当前日期。*

#### B. 标识符序列替换 (Sequential Replacement)

原始 CSV 中包含多个标识行（内容通常为 `"x","y"`）。程序需按**出现顺序**依次替换这些标识行为以下指定的 `curve` 标签：

1. 第 1 次出现：`curve { -1.8 }`

2. 第 2 次出现：`curve { -1.35 }`

3. 第 3 次出现：`curve { -0.9 }`

4. 第 4 次出现：`curve { -0.45 }`

5. 第 5 次出现：`curve { 0 }`

#### C. 数据行排版 (Formatting)

对于所有非标识符的数据行（具体的数值对）：

* **双列布局**：第一列为 X 轴数据，第二列为 Y 轴数据。

* **宽度强制**：第一列采用 **左对齐**，并固定占用 **20 个字符宽度**。

* **对齐效果**：确保所有行的第二列在垂直方向上起始位置完全一致。

## 3. 技术约束

* **技术栈**：推荐使用 Python + Streamlit（为了快速生成 Web UI）。

* **健壮性**：如果 CSV 格式异常（如标识行少于 5 个），应给出友好提示。

* **输出格式**：
  * 支持输出 `.txt` 和 `.mea` 两种格式，文件内容完全一致。
  * 编码格式为 `UTF-8`。
  * 用户可选择下载 `.txt` 或 `.mea` 格式文件。

## 4. 示例对比

**输入 (CSV):**

```csv
"x","y"
-2.0, 1.2e-5
-1.9, 1.5e-5
"x","y"
-2.0, 2.1e-6
```

**输出 (TXT/MEA) 效果展示:**

```text
condition{date=1/5/26,instrument=pseudo.meter,mode=forward,type=nmos}

Page (name=Ids_Vgs_Vbs,x=Vgs,p=Vbs,y=Ids){Vds=0.1,W=1,L=10,T=25}
curve { -1.8 }
-2.0                1.2e-5
-1.9                1.5e-5
curve { -1.35 }
-2.0                2.1e-6
```

*注：condition 行和 Page 行之间有一个空行。*

---

